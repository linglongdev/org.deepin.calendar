test_build:
  steps:
    - branch_package:
        source_project: linglong:app
        source_package: template_CI
        target_project: linglong:app:CI:amd64
        target_package: %{SCM_REPOSITORY_NAME}
        description: "Created by https://github.com/%{SCM_ORGANIZATION_NAME}/%{SCM_REPOSITORY_NAME}/pull/%{SCM_PR_NUMBER}"

    - configure_repositories:
        project: linglong:app:CI:amd64
        repositories:
          - name: deepin_23_repo
            paths:
              - target_project: linglong:app:CI
                target_repository: deepin_23_repo
            architectures:
              - x86_64

    - branch_package:
        source_project: linglong:app
        source_package: template_CI_aarch64
        target_project: linglong:app:CI:aarch64
        target_package: %{SCM_REPOSITORY_NAME}
        description: "Created by https://github.com/%{SCM_ORGANIZATION_NAME}/%{SCM_REPOSITORY_NAME}/pull/%{SCM_PR_NUMBER}"

    - configure_repositories:
        project: linglong:app:CI:aarch64
        repositories:
          - name: deepin_23_repo
            paths:
              - target_project: linglong:app:CI
                target_repository: deepin_23_repo
            architectures:
              - aarch64

    - branch_package:
        source_project: linglong:app
        source_package: template_CI_loongarch64
        target_project: linglong:app:CI:loongarch64
        target_package: %{SCM_REPOSITORY_NAME}
        description: "Created by https://github.com/%{SCM_ORGANIZATION_NAME}/%{SCM_REPOSITORY_NAME}/pull/%{SCM_PR_NUMBER}"

    - configure_repositories:
        project: linglong:app:CI:loongarch64
        repositories:
          - name: uos_1070_repo
            paths:
              - target_project: linglong:app:CI
                target_repository: uos_1070_repo
            architectures:
              - loongarch64

  filters:
    event: pull_request
# commit_build:
#   steps:
#     - branch_package:
#         source_project: linglong:app
#         source_package: template_CI
#         target_project: linglong:app:Testing
#         target_package: %{SCM_REPOSITORY_NAME}
#     - branch_package:
#         source_project: linglong:app
#         source_package: template_CI_aarch64
#         target_project: linglong:app:Testing:aarch64
#         target_package: %{SCM_REPOSITORY_NAME}
#   filters:
#     event: push
